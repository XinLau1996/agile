<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <title>登录</title>
    <base th:href="${#request.getContextPath()}+'/'">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport"/>
    <link rel="icon" href="static/favicon.ico"/>
    <link rel="stylesheet" href="static/common/element/index.css"/>
</head>

<body class="hold-transition login-page">
<div id="app">
    <template>
        <div class="login-container">
            <el-form :model="loginForm" :rules="rules" ref="loginForm" label-position="left" label-width="0px">
                <h3 class="title">系统登录</h3>
                <el-form-item prop="username">
                    <el-input prefix-icon="el-icon-user" type="text" v-model="loginForm.username" placeholder="登录账号"></el-input>
                </el-form-item>
                <el-form-item prop="password">
                    <el-input prefix-icon="el-icon-lock" v-model="loginForm.password" placeholder="登录密码" @keyup.enter.native="login" show-password></el-input>
                </el-form-item>
                <el-form-item>
                    <el-checkbox v-model="checked" class="rememberMe">记住密码</el-checkbox>
                </el-form-item>
                <el-form-item style="width:100%;">
                    <el-button type="primary" style="width:100%;" @click="login" :loading="loading">登录</el-button>
                </el-form-item>
            </el-form>
        </div>
    </template>
</div>
</body>
<script type="text/javascript" src="/static/common/util/axios.min.js"></script>
<script type="text/javascript" src="/static/common/util/vue-cookies.js"></script>
<script type="text/javascript" src="/static/common/vue/vue.min.js"></script>
<script type="text/javascript" src="/static/common/element/index.js"></script>
<script type="text/javascript" src="/static/common/api.js"></script>
<script type="text/javascript">
    new Vue({
        el: '#app',
        data() {
            return {
                loading: false,
                checked: false,
                loginForm: {
                    username: '',
                    password: ''
                },
                rules: {
                    username: [{required: true, message: '请输入登录账号', trigger: 'blur'}],
                    password: [{required: true, message: '请输入登录密码', trigger: 'blur'}]
                },
                buttons: [],
            }
        },
        beforeCreate: function () {
            if (self !== top) {
                top.location.href = self.location.href;
            }
        },
        methods: {
            login(event) {
                this.$refs.loginForm.validate((valid) => {
                    if (valid) {
                        this.loading = true;
                        axios.post('login', {
                            username: this.loginForm.username,
                            password: this.loginForm.password
                        }).then((res) => {
                            if (res.code === 6666) {
                                localStorage.setItem('X-Access-Token', JSON.stringify(res.data.token));
                                localStorage.setItem('X-Data-User', JSON.stringify(res.data.user));
                                if (this.checked) {
                                    // const account = this.loginForm.username + "," + this.loginForm.password;
                                    // console.log(account);
                                    // console.log(this);
                                    // this.$cookies.set("account", account, "30d");
                                }
                                parent.location.href = '/view/home.html';
                            } else {
                                this.loading = false;
                                this.$message.error(res.message);
                            }
                        });
                    } else {
                        return false;
                    }
                })
            },
        }
    })
</script>
<style scoped>
    .login-page {
        -webkit-border-radius: 5px;
        border-radius: 5px;
        margin: 180px auto;
        width: 350px;
        padding: 35px 35px 15px;
        background: #fff;
        border: 1px solid #eaeaea;
        box-shadow: 0 0 25px #cac6c6;
    }

    .login-container {
        width: 100%;
        height: 100%;
    }
</style>

</html>